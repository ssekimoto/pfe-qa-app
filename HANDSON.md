# Gemini CLI ハンズオンガイド: Webアプリの変更とE2Eテスト

このハンズオンでは、Gemini CLI を使って、シンプルなWebアプリケーションの改修と、それに対するE2E（End-to-End）テストの計画・作成・実行までの一連の流れを体験します。

## 0. 準備: 仮想環境の作成とライブラリのインストール

システムのPython環境を汚さずにプロジェクト固有のライブラリを管理するため、まず「仮想環境」を作成します。

### 0.1. 仮想環境の作成

**プロンプト:**
```
python3 -m venv .venv を実行して仮想環境を作成してください。
```

### 0.2. ライブラリのインストール

次に、作成した仮想環境内に、アプリケーションとテストの実行に必要なPythonライブラリをインストールします。

**プロンプト:**
```
.venv/bin/pip install -r requirements.txt を実行して、必要なライブラリをインストールしてください。
```

## 1. アプリケーションの起動

Webアプリケーションを起動します。このアプリはFastAPIで構築されています。
今後のコマンドは、先ほど作成した仮想環境内で実行する必要があります。

**プロンプト:**
```
.venv/bin/uvicorn main:app --host 0.0.0.0 --port 8000 をバックグラウンドで実行してください。
```
Gemini CLIがサーバーを起動します。起動後、ブラウザで `http://127.0.0.1:8000` にアクセスし、"Greet App"というタイトルのシンプルな画面が表示されることを確認してください。

## 2. アプリケーションの変更計画 (ユーザー作業)

ここで、アプリケーションにどのような変更を加えたいか、自由に計画を立てます。
例えば、以下のような変更が考えられます。

*   ページのタイトルを "Super Greet App" に変更する。
*   挨拶の文言を "Hello, {name}!" から "Hi, {name}!!" に変更する。
*   入力フィールドのラベルを "Your Name:" に変更する。

あなたの変更計画を `change_spec.md` という名前のファイルにMarkdown形式で記述してください。（この作業は普段お使いのエディタで行ってください）

**`change_spec.md` の例:**
```markdown
# アプリケーション変更仕様

1.  `index.html` の `<title>` タグを "Super Greet App" に変更する。
2.  `main.py` の `/api/greet` エンドポイントが返す挨拶メッセージを "Hi, {name}!!" に変更する。
```

## 3. 計画に基づいたアプリケーションの修正

作成した `change_spec.md` をGemini CLIに読み込ませ、その指示に基づいてアプリケーションを修正してもらいます。

**プロンプト:**
```
`change_spec.md` の内容を読み込んで、その指示通りにアプリケーションを修正してください。
```
Gemini CLIは `change_spec.md` を解釈し、`index.html` と `main.py` を修正するはずです。

## 4. テスト計画の作成 (ユーザー作業)

加えた変更が正しく動作することを確認するためのテストを計画します。
先ほどの変更に対応するテスト計画を `test_plan.md` というファイルに記述してください。

**`test_plan.md` の例:**
```markdown
# テスト計画

1.  **テストケース1: タイトルの確認**
    *   ページにアクセスした際、ページのタイトルが "Super Greet App" になっていることを確認する。

2.  **テストケース2: 挨拶メッセージの確認**
    *   名前に "Gemini" と入力してボタンをクリックした際、"Hi, Gemini!!" というメッセージが表示されることを確認する。
```

## 5. テスト計画に基づいたテストコードの作成

作成した `test_plan.md` を基に、Gemini CLIにE2Eテストを書いてもらいます。

**プロンプト:**
```
`test_plan.md` を読み込んで、`test_e2e.py` に書かれている既存のテストを更新、または新しいテストを追加してください。テストフレームワークはPlaywrightです。
```
Gemini CLIは `test_e2e.py` を修正し、新しい仕様に合ったテストコードを生成します。

## 6. テストの実行

最後に、更新されたE2Eテストを実行して、アプリケーションの変更が正しく行われ、既存の機能も壊れていない（デグレしていない）ことを確認します。

**プロンプト:**
```
Playwrightのテストを実行してください。
```
Gemini CLIは、仮想環境内の `pytest` または `playwright` を使ってテスト (`.venv/bin/pytest test_e2e.py` など) を実行します。テスト結果（成功または失敗）が報告されます。

---

以上でハンズオンは終了です。この手順を通して、Gemini CLIを活用した開発サイクルを体験できました。
